% Preamble
\documentclass[10pt]{article}
\title{Supplementary Material}
\author{Yihang Cheng}
\date{\today}
% Packages
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{multirow}
\usepackage{array}
\usepackage[colorlinks=true, linkcolor=blue, urlcolor=blue, citecolor=blue]{hyperref}
\usepackage{listings}
\usepackage{xcolor}
% Document
\begin{document}
\maketitle
\newpage
\tableofcontents
\newpage
\section{Software tools developed in this study}\label{sec:software-develope}
The analysis algorithms and methodologies employed in this paper were integrated into two tool sets:

\begin{itemize}
    \item  \href{https://github.com/hcyvan/epiLungCancer/tree/main/methytools}{\textit{methytools}}: 
    \item \href{https://github.com/hcyvan/pattools}{\textit{pattools}}: 
\end{itemize}

\subsection{methytools}\label{sec:software-develope-methytools}

methytools is a toolkit developed for processing BS-seq methylation data.

\subsubsection{mcomppost percentile}

\emph{mcomppost percentile} can be used to calculate the percentile of each CpGs and add percentile columns to the DMCs files.

\begin{lstlisting}[language=sh, caption={}]
mcomppost percentile -i ./dmc.Rest.vs.CTL.txt \
                     -m ./merge.d3.all.bed.gz \
                     -t ./sample.CTL.txt \
                     -o ./dmc.Rest.vs.CTL.percentile.txt
\end{lstlisting}

\subsection{pattools}\label{sec:software-develope-pattools}

pattools is a toolkit based on PAT format\cite{Loyfer2024.05.08.593132} data, inheriting both existing methylation algorithms and incorporating new ones.
{pattools} is currently under development, and the algorithms from this toolkit are primarily utilized in this study. The
 software will be introduced in a forthcoming paper.

 \subsubsection{pattools vector}

\section{Selection of subtype-specific DMCs}\label{sec:selection-of-dmcs}

\subsection{One-vs-Rest}

We employed the One-vs-Rest strategy to identify specific differentially methylated CpGs (DMCs) across various
subtypes of lung cancer, using MOABS\cite{sun_moabs_2014} for preliminary screening. The target group and Background
group are shown in the following table\ref*{tab:grouping}.

\begin{table}[htbp]
    \begin{center}
        \caption{ Grouping of One-vs-Rest }
        \begin{tabular}{|c|c|}
            \hline
            Target & Background            \\
            \hline
            CTL    & LUAD, LUSC, LCC, SCLC \\
            LUAD   & CTL, LUSC, LCC, SCLC  \\
            LUSC   & CTL, LUAD, LCC, SCLC  \\
            LCC    & CTL, LUAD, LUSC, SCLC \\
            SCLC   & CTL, LUAD, LUSC, LCC  \\
            \hline
        \end{tabular}
    \end{center}
    \label{tab:grouping}
\end{table}

\subsection{MOABS mcomp}

Using the default parameters of MOABS, we obtained a large number of DMCs in each comparison group (Table \ref{tab:table_dmc_ount}).
Subsequently, duplicated differentially methylated CpG sites (DMCs) across multiple groups were excluded, leaving
only those specific to CTL, LUAD, LUSC, LCC, and SCLC.

\begin{table}[htbp]
    \begin{center}
        \caption{The count of DMCs find by MOABS}
        \begin{tabular}{|c|c|c|}
            \hline
            \multirow{2}{*}{Group} & \multicolumn{2}{c|}{Remove multiple DMCs}           \\
            \cline{2-3}            & Befor                                     & After   \\
            \hline
            CTL vs. Rest           & 584239                                    & 145200  \\
            LUAD vs. Rest          & 95999                                     & 31299   \\
            LUSC vs. Rest          & 427525                                    & 326642  \\
            LCC vs. Rest           & 1361568                                   & 1090432 \\
            SCLC vs. Rest          & 3022977                                   & 2349828 \\
            \hline
        \end{tabular}
    \end{center}
    \label{tab:table_dmc_ount}
\end{table}

\subsection{\textit{p}-th percentile algorithm}

A more stringent strategy was then used for further screening of DMCs. We evaluate the 
\textit{p}-th percentile of low-methylated group and the (\textit{100 - p})-th percentile
of high-methylated group. In hypermethylated DMCs, the \textit{p}-th percentile of the target
group and the (\textit{100 - p})-th percentile of the background are calculated; conversely,
in hypomethylated DMCs, this relationship is reversed. If the \textit{p}-th percentile of the
low-methylated group is less than or equal to (\textit{100-p})-th percentile of the high-methylated
group, we assert that this DMCs adheres to our screening criteria (Figure \ref*{fig:dmcPC}).

\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.8\linewidth]{./img/dmcPercentileCut.png}
    \caption{The 85-th percentile of target and background samples in a hypomethylated DMCs}
    \label{fig:dmcPC}
\end{figure}

Utilizing \emph{mcomppost}, we conducted an analysis of the DMCs within each group. As the \textit{p}-th percentile increased, the number of retained DMCs 
decreased significantly (Figure \ref*{fig:dmcPK}). By selecting an appropriate percentile (\textit{p}) threshold, we can identify DMCs that more stringently adhere to 
group specificity.


\begin{figure}[htbp]
    \centering
    \includegraphics[width=1\linewidth]{./img/dmcPercentileVsKeepProp}
    \caption{The remaining DMC propertion after filtering with different percentiles}
    \label{fig:dmcPK}
\end{figure}

\section{Code availability}\label{sec:code}

The analysis code of this artile a available in Github repository \href{https://github.com/hcyvan/epiLungCancer}{epiLungCancer}. The
sub project of epiLungCancer, \href{https://github.com/hcyvan/epiLungCancer/tree/main/methytools}{\textit{methytools}},  was developed to process
BS-seq methylation data.



\bibliographystyle{plain}
\bibliography{SupplymentaryMaterialReference}
\end{document}